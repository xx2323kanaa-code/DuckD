<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>Duck Prosthesis UI ‚Äì SAFE CAMERA START</title>

<!-- TF (Âæå„Åß‰Ωø„ÅÜ„ÄÇ‰ªä„ÅØËµ∑Âãï„Åó„Å™„ÅÑ) -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>

<style>
html,body{
  margin:0; padding:0;
  width:100%; height:100%;
  background:#111;
  overflow:hidden;
  font-family: system-ui, sans-serif;
}

/* ===== main view ===== */
#stage{
  position:relative;
  width:100%;
  height:100%;
  background:#111;
}

#handImage{
  position:absolute;
  inset:0;
  background:url("hand_open.png") center/contain no-repeat;
}

/* ===== camera ===== */
#video{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
  display:none;
}

/* ===== menu ===== */
#menuBtn{
  position:fixed;
  top:10px; right:10px;
  z-index:1000;
  width:44px; height:36px;
  border-radius:10px;
  border:1px solid #888;
  background:#222;
  color:#fff;
  font-size:18px;
}

#menu{
  position:fixed;
  top:52px; right:10px;
  z-index:1000;
  background:#222;
  border:1px solid #555;
  border-radius:12px;
  padding:10px;
  display:none;
  width:220px;
}

#menu button{
  width:100%;
  margin-bottom:8px;
  padding:8px;
  border-radius:8px;
  border:1px solid #666;
  background:#333;
  color:#fff;
  font-size:14px;
}

/* ===== HUD ===== */
#hud{
  position:fixed;
  top:10px; left:10px;
  max-width:85%;
  background:rgba(0,0,0,0.7);
  border:1px solid #0f0;
  border-radius:10px;
  padding:8px;
  color:#9f9;
  font-size:11px;
  white-space:pre-wrap;
  display:none;
  z-index:900;
}
</style>
</head>

<body>
<div id="stage">
  <div id="handImage"></div>
  <video id="video" autoplay muted playsinline></video>
</div>

<button id="menuBtn">‚ò∞</button>

<div id="menu">
  <button id="startCam">‚ñ∂ Start Camera</button>
  <button id="stopCam">‚èπ Stop / Reset</button>
  <button id="toggleHud">üêû Debug HUD</button>
  <button id="copyHud">üìã Copy HUD</button>
</div>

<div id="hud">HUD ready</div>

<script>
/* ===== state ===== */
let stream = null;
let hudOn = false;
let hudLogs = [];

/* ===== elements ===== */
const video = document.getElementById("video");
const hand  = document.getElementById("handImage");
const hud   = document.getElementById("hud");
const menu  = document.getElementById("menu");

/* ===== menu ===== */
document.getElementById("menuBtn").onclick = ()=>{
  menu.style.display = menu.style.display==="block" ? "none":"block";
};

/* ===== HUD ===== */
function logHUD(text){
  hudLogs.push(text);
  if(hudLogs.length > 50) hudLogs.shift(); // Ëá™ÂãïÁ†¥Ê£Ñ
  hud.textContent = hudLogs.join("\n");
}

document.getElementById("toggleHud").onclick = ()=>{
  hudOn = !hudOn;
  hud.style.display = hudOn ? "block":"none";
};

document.getElementById("copyHud").onclick = async ()=>{
  await navigator.clipboard.writeText(hud.textContent);
};

/* ===== camera ===== */
document.getElementById("startCam").onclick = async ()=>{
  if(stream) return;
  stream = await navigator.mediaDevices.getUserMedia({
    video:{ facingMode:"environment", width:640, height:480 },
    audio:false
  });
  video.srcObject = stream;
  video.style.display = "block";
  hand.style.display = "none";

  logHUD("Camera started");
  logHUD("secure: "+window.isSecureContext);
  logHUD("UA: "+navigator.userAgent);
};

document.getElementById("stopCam").onclick = ()=>{
  if(stream){
    stream.getTracks().forEach(t=>t.stop());
    stream = null;
  }
  video.style.display = "none";
  hand.style.display = "block";
  logHUD("Camera stopped / reset");
};
</script>
</body>
</html>
